<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Airdrop TurboTuga</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white font-sans">
  <div class="max-w-3xl mx-auto p-6">
    <h1 class="text-3xl font-bold mb-4">ðŸš€ TurboTuga Airdrop</h1>
    <button id="connectBtn" class="bg-purple-600 px-4 py-2 rounded">Connect Wallet</button>

    <!-- Tabs -->
    <div class="flex gap-2 mt-6">
      <button class="tab bg-gray-700 px-3 py-1 rounded active" data-tab="mass">Mass Send</button>
      <button class="tab bg-gray-700 px-3 py-1 rounded" data-tab="rewards">Register Reward</button>
      <button class="tab bg-gray-700 px-3 py-1 rounded" data-tab="claim">Claim Reward</button>
    </div>

    <!-- Mass Send -->
    <div id="panel-mass" class="mt-6">
      <h2 class="text-xl mb-2">Mass Send</h2>
      <input id="mint" placeholder="Mint Address" class="w-full p-2 mb-2 text-black"/>
      <input id="decimals" type="number" placeholder="Token Decimals" class="w-full p-2 mb-2 text-black"/>
      <input id="amountEach" type="number" placeholder="Amount Each" class="w-full p-2 mb-2 text-black"/>
      <textarea id="destinations" placeholder="Wallets (one per line)" class="w-full p-2 mb-2 text-black"></textarea>
      <button id="sendMassBtn" class="bg-green-600 px-4 py-2 rounded">Send Tokens</button>
      <pre id="logMass" class="bg-black text-green-400 p-2 mt-2 h-40 overflow-y-auto"></pre>
    </div>

    <!-- Register Reward -->
    <div id="panel-rewards" class="mt-6 hidden">
      <h2 class="text-xl mb-2">Register Reward</h2>
      <input id="campName" placeholder="Campaign Name" class="w-full p-2 mb-2 text-black"/>
      <input id="campMint" placeholder="Mint Address" class="w-full p-2 mb-2 text-black"/>
      <input id="campDecimals" type="number" placeholder="Token Decimals" class="w-full p-2 mb-2 text-black"/>
      <textarea id="campAllow" placeholder="Allowed Wallets (one per line)" class="w-full p-2 mb-2 text-black"></textarea>
      <input id="campAmount" type="number" placeholder="Reward Amount" class="w-full p-2 mb-2 text-black"/>
      <button id="registerCampBtn" class="bg-blue-600 px-4 py-2 rounded">Register</button>
      <pre id="logReg" class="bg-black text-blue-400 p-2 mt-2 h-40 overflow-y-auto"></pre>
    </div>

    <!-- Claim Reward -->
    <div id="panel-claim" class="mt-6 hidden">
      <h2 class="text-xl mb-2">Claim Reward</h2>
      <input id="claimCode" placeholder="Campaign Code" class="w-full p-2 mb-2 text-black"/>
      <button id="claimBtn" class="bg-yellow-600 px-4 py-2 rounded">Claim</button>
      <pre id="logClaim" class="bg-black text-yellow-400 p-2 mt-2 h-40 overflow-y-auto"></pre>
    </div>
  </div>

  <!-- Script -->
  <script type="module">
    import * as web3 from "https://cdn.jsdelivr.net/npm/@solana/web3.js@1.95.4/lib/index.esm.js";
    import {
      getAssociatedTokenAddress,
      createAssociatedTokenAccountInstruction,
      createTransferInstruction,
      TOKEN_PROGRAM_ID
    } from "https://cdn.jsdelivr.net/npm/@solana/spl-token@0.4.6/lib/index.esm.js";

    const $ = (id)=>document.getElementById(id);
    const log=(el,msg)=>{ el.textContent+=`\\n${new Date().toLocaleTimeString()} â”€ ${msg}`; el.scrollTop=el.scrollHeight; };

    let provider=null, connection=null, walletPubkey=null;
    const DEFAULT_RPC="https://api.devnet.solana.com";

    // Tabs
    document.querySelectorAll('.tab').forEach(t=>t.addEventListener('click',()=>{
      document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
      t.classList.add('active');
      const target=t.getAttribute('data-tab');
      ["mass","rewards","claim"].forEach(id=>{
        $("panel-"+id).classList.toggle('hidden',id!==target);
      });
    }));

    // Connect Wallet
    $("connectBtn").onclick=async()=>{
      provider=window.solana||window.phantom?.solana;
      if(!provider){ alert("Install Phantom Wallet"); return; }
      const resp=await provider.connect();
      walletPubkey=new web3.PublicKey(resp.publicKey.toString());
      $("connectBtn").textContent=`Connected: ${walletPubkey.toString().slice(0,4)}...${walletPubkey.toString().slice(-4)}`;
      connection=new web3.Connection(DEFAULT_RPC,'confirmed');
      log($("logMass"),"Wallet connected on Devnet");
    };

    // Mass Send
    $("sendMassBtn").onclick=async()=>{
      const mint=$("mint").value.trim();
      const decimals=parseInt($("decimals").value);
      const amount=parseFloat($("amountEach").value);
      const dests=$("destinations").value.trim().split("\\n").filter(x=>x);
      const logEl=$("logMass");
      if(!walletPubkey){ alert("Connect wallet first"); return; }
      if(!mint||!amount||dests.length===0){ log(logEl,"Fill all fields"); return; }

      log(logEl,`Sending ${amount} tokens to ${dests.length} wallets...`);
      const mintPub=new web3.PublicKey(mint);
      const ataSender=await getAssociatedTokenAddress(mintPub,walletPubkey);

      for(const dest of dests){
        try{
          const destPub=new web3.PublicKey(dest);
          const ataDest=await getAssociatedTokenAddress(mintPub,destPub);
          const instructions=[];
          const info=await connection.getAccountInfo(ataDest);
          if(!info) instructions.push(createAssociatedTokenAccountInstruction(walletPubkey,ataDest,destPub,mintPub));
          instructions.push(createTransferInstruction(ataSender,ataDest,walletPubkey,amount*(10**decimals)));
          const tx=new web3.Transaction().add(...instructions);
          const sig=await provider.signAndSendTransaction(tx);
          log(logEl,`Sent to ${dest}: ${sig}`);
        }catch(e){ log(logEl,`Error sending to ${dest}: ${e.message}`); }
      }
    };

    // Register Reward
    let campaigns={};
    $("registerCampBtn").onclick=()=>{
      const name=$("campName").value.trim();
      const mint=$("campMint").value.trim();
      const decimals=parseInt($("campDecimals").value);
      const allow=$("campAllow").value.trim().split("\\n").filter(x=>x);
      const amount=parseFloat($("campAmount").value);
      const logEl=$("logReg");
      if(!name||!mint||!decimals||!allow.length||!amount){ log(logEl,"Fill all fields"); return; }
      const code=Math.random().toString(36).substring(2,10).toUpperCase();
      campaigns[code]={name,mint,decimals,allow,amount};
      log(logEl,`Campaign registered: ${name} | Code: ${code}`);
    };

    // Claim Reward
    $("claimBtn").onclick=async()=>{
      const code=$("claimCode").value.trim().toUpperCase();
      const logEl=$("logClaim");
      if(!walletPubkey){ alert("Connect wallet first"); return; }
      if(!campaigns[code]){ log(logEl,"Invalid code"); return; }
      const campaign=campaigns[code];
      if(!campaign.allow.includes(walletPubkey.toString())){ log(logEl,"Wallet not authorized"); return; }

      try{
        const mintPub=new web3.PublicKey(campaign.mint);
        const destPub=walletPubkey;
        const ataDest=await getAssociatedTokenAddress(mintPub,destPub);
        const ataSender=await getAssociatedTokenAddress(mintPub,walletPubkey);
        const instructions=[];
        const info=await connection.getAccountInfo(ataDest);
        if(!info) instructions.push(createAssociatedTokenAccountInstruction(walletPubkey,ataDest,destPub,mintPub));
        instructions.push(createTransferInstruction(ataSender,ataDest,walletPubkey,campaign.amount*(10**campaign.decimals)));
        const tx=new web3.Transaction().add(...instructions);
        const sig=await provider.signAndSendTransaction(tx);
        log(logEl,`Claimed ${campaign.amount} tokens | Tx: ${sig}`);
      }catch(e){ log(logEl,`Error: ${e.message}`); }
    };
  </script>
</body>
</html>


